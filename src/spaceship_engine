export default class{
	constructor(spaceship){
		this.spaceship = spaceship
	}

    turnOn(){
        Promise.all([this.checkCurrentLoad(), this.testShield()]).then(results => {
			return this.normalizeShield(results[1])
		}).then(normalizeShield => {
			this.spaceship.shield = normalizeShield
			console.log(`(${this.spaceship.name}) Partida autorizada: Escudo(${this.spaceship.shield}) e Carga(${this.spaceship.currentLoad})`)
		}).catch(errors => {
			console.log(`(${this.spaceship.name}) Partida nÃ£o autorizada: ${errors}`)
		})
    }

	checkCurrentLoad(){
		return new Promise((resolve, reject) => {
				let percentLoad = this.spaceship.percentLoad()
				if(percentLoad>30){
					resolve(percentLoad)
				} else {
					reject(`Carga atual em ${percentLoad}GJ`)
				}
		})
	}

	testShield(){
		return new Promise((resolve, reject) => {
			if(this.spaceship.doubleShield() < 100){
				reject("Erro no teste de escudo.")
			} else {
				resolve(this.spaceship.doubleShield())
			}
		})		
	}

	normalizeShield(doubleShield){
		return new Promise((resolve, reject) => {
			let normalizeShield = doubleShield * 0.7
			if (normalizeShield > 120) {
				reject("Escudo sobrecarregado")
			} else {
				resolve(normalizeShield)
			}
		})
	}
}